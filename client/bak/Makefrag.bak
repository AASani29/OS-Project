OBJDIRS += client

CLIENT_DIR := client
CLIENT_OBJ_DIR := client

CLIENT_CFLAGS	:= $(CFLAGS) -m32 -D_CLIENT_ -O1 -I$(TOP)  -I$(CLIENT_DIR)/include
CLIENT_LDFLAGS	:= $(LDFLAGS) -m elf_i386 -Ttext=0x40000000

#CLIENT_SRC	+=$(CLIENT_DIR)/entry.S
#CLIENT_SRC	+=$(CLIENT_DIR)/client1.c

#CLIENT_SRC   := $(wildcard $(CLIENT_SRC))
#CLIENT_OBJ   := $(patsubst %.c, $(OBJDIR)/%.o, $(CLIENT_SRC))
#CLIENT_OBJ   := $(patsubst %.S, $(OBJDIR)/%.o, $(CLIENT_OBJ))

CLIB_SRCFILES := client/printfmt.c client/printf.c client/string.c client/syscall.c
CLIB_SRCFILES := $(wildcard $(CLIB_SRCFILES))
CLIB_OBJFILES := $(patsubst client/%.c, $(OBJDIR)/client/%.o, $(CLIB_SRCFILES))
CLIB_OBJFILES := $(patsubst client/%.S, $(OBJDIR)/client/%.o, $(CLIB_OBJFILES))

$(OBJDIR)/client/libclient.a: $(CLIB_OBJFILES)
	@echo + ar[CLIENT] $@
	$(V)$(AR) r $@ $(CLIB_OBJFILES)

$(OBJDIR)/client/%.o: client/%.c
	@echo + cc[CLIENT] $@ $<
	@mkdir -p $(@D)
	$(V)$(CC) -nostdinc $(CLIENT_CFLAGS) -c -o $@ $<

$(OBJDIR)/client/%.o: client/%.S
	@echo + as[CLIENT] $<
	@mkdir -p $(@D)
	$(V)$(CC) -nostdinc $(CLIENT_CFLAGS) -c -o $@ $<

$(OBJDIR)/client/client1: $(OBJDIR)/client/%.o $(OBJDIR)/client/entry.o $(OBJDIR)/client/libclient.a  $(CLIENT_OBJ)
	@echo + ld[CLIENT] $@
	$(V)$(LD) -o $@ $(CLIENT_LDFLAGS) $(OBJDIR)/client/entry.o $@.o \
		-L$(OBJDIR)/client -lclient $(GCC_LIB) -b binary $(OBJDIR)/client/client1 
	$(V)$(OBJDUMP) -S $@ > $@.asm
	$(V)$(NM) -n $@ > $@.sym

